# ==============================================================================
# E-Commerce Platform - DEVELOPMENT Override
# ==============================================================================
# This file adds development-specific configurations:
# - Exposes ports for debugging
# - Enables hot reload
# - Adds development volumes
#
# Usage:
#   docker-compose -f docker-compose.base.yaml -f docker-compose.dev.yaml up
# ==============================================================================

services:
  # Expose ports for development debugging
  postgres:
    ports:
      - "5432:5432"

  postgres_ai:
    ports:
      - "5433:5432"

  redis:
    ports:
      - "6379:6379"

  elasticsearch:
    ports:
      - "9200:9200"
      - "9300:9300"

  qdrant:
    ports:
      - "6333:6333"
      - "6334:6334"

  rabbitmq:
    ports:
      - "5672:5672"
      - "15672:15672"

  backend:
    ports:
      - "8000:8000"
    volumes:
      # Mount source code for hot reload
      - ../services/backend:/app
    environment:
      - DEBUG=True

  api_gateway:
    ports:
      - "8080:8080"
    volumes:
      - ../ai-services/api_gateway:/app
      - ../ai-services/shared:/app/shared

  recommender:
    ports:
      - "8001:8001"
    volumes:
      - ../ai-services/services/recommendation_engine:/app
      - ../ai-services/shared:/app/shared

  search:
    ports:
      - "8002:8002"
    volumes:
      - ../ai-services/services/search_engine:/app
      - ../ai-services/shared:/app/shared

  pricing:
    ports:
      - "8003:8003"
    volumes:
      - ../ai-services/services/pricing_engine:/app
      - ../ai-services/shared:/app/shared

  chatbot:
    ports:
      - "8004:8004"
    volumes:
      - ../ai-services/services/chatbot_rag:/app
      - ../ai-services/shared:/app/shared

  fraud:
    ports:
      - "8005:8005"
    volumes:
      - ../ai-services/services/fraud_detection:/app
      - ../ai-services/shared:/app/shared

  forecasting:
    ports:
      - "8006:8006"
    volumes:
      - ../ai-services/services/demand_forecasting:/app
      - ../ai-services/shared:/app/shared

  vision:
    ports:
      - "8007:8007"
    volumes:
      - ../ai-services/services/visual_recognition:/app
      - ../ai-services/shared:/app/shared

  prometheus:
    ports:
      - "9090:9090"

  grafana:
    ports:
      - "3001:3000"

  jaeger:
    ports:
      - "5775:5775/udp"
      - "6831:6831/udp"
      - "6832:6832/udp"
      - "5778:5778"
      - "16686:16686"  # Jaeger UI
      - "14268:14268"
      - "14250:14250"
      - "9411:9411"
      - "4317:4317"
      - "4318:4318"

  # ============================================================================
  # DEVELOPMENT TOOLS (Only available in dev environment)
  # ============================================================================

  # Mailhog for testing emails (dev only)
  mailhog:
    image: mailhog/mailhog:latest
    container_name: ecommerce_mailhog
    ports:
      - "1025:1025"  # SMTP
      - "8025:8025"  # Web UI
    networks:
      - backend_network

  # pgAdmin for database management (dev only)
  pgadmin:
    image: dpage/pgadmin4:latest
    container_name: ecommerce_pgadmin
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@example.com
      PGADMIN_DEFAULT_PASSWORD: admin
      PGADMIN_CONFIG_SERVER_MODE: 'False'
    ports:
      - "5050:80"
    volumes:
      - pgadmin_data:/var/lib/pgadmin
    networks:
      - backend_network
    depends_on:
      - postgres

  # Redis Commander for Redis management (dev only)
  redis-commander:
    image: rediscommander/redis-commander:latest
    container_name: ecommerce_redis_commander
    environment:
      - REDIS_HOSTS=local:redis:6379
    ports:
      - "8081:8081"
    networks:
      - backend_network
    depends_on:
      - redis

volumes:
  pgadmin_data:
